<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>用户中心</title>
		<link rel="stylesheet" href="../css/other/bootstrap.min.css" />
		<link rel="stylesheet" href="../css/ourself/common/common.css" />
		<link rel="stylesheet" href="../css/ourself/user/user.css" />

		<!--<link rel="stylesheet" href="../css/other/default.css" />-->
		<link rel="stylesheet" media="all" href="../css/other/fileinput.css" />

		<link rel="stylesheet" href="../css/other/tab/normalize.css" />
		<link rel="stylesheet" href="../css/other/tab/style.css" />

		<link rel="stylesheet" href="../css/other/pagination.css" />

		<script type="text/javascript" src="../js/other/jquery-1.11.2.min.js"></script>
		<script type="text/javascript" src="../js/other/bootstrap.min.js"></script>
		<script type="text/javascript" src="../js/ourself/common/common.js"></script>

		<script type="text/javascript" src="../js/ourself/common/topBottom.js"></script>
		<script type="text/javascript" src="../js/ourself/user/mustLogin.js"></script>

		<script type="text/javascript" src="../js/other/fileinput.js"></script>
		<script type="text/javascript" src="../js/other/zh.js"></script>

		<script type="text/javascript" src="../js/other/jquery.pagination.js"></script>
	</head>
	<style>
		.contenDiv {
			min-height: 300px;
		}
	</style>

	<body>
		<div class="mainContainer">
			<div class="mainContent">
				<br />
				<div class="allWidth" style="border-radius: 10px;border-style: solid;border-color: #2fa0ec;border-width: 2px;padding: 20px;">
					<div class="myCenter">
						<h2 style="color: deeppink;">个人中心</h2>
						<span class="redTip"></span>
					</div>
					<div style="margin-top: 30px;">
						<div style="height: 200px;">
							<div style="float: left;">
								<img class="bigHeadImage" src="" />
							</div>
							<div style="float: left;margin-left: 20px;">
								<form>
									<a id="showSex" href="javascript:void(0);" onclick="showSex();"><span class="secret icon"></span></a>
									<select id="selectSex" name="sex" class="form-control" style="width: 80px;display: none;" onchange="update();">
										<option value="男">男</option>
										<option value="女">女</option>
										<option value="保密">保密</option>
									</select>
									<br />
									<br />
									<input style="min-width: 400px;text-align: left;" type=" text " name="signature" class="form-control" onchange="update();" placeholder="个性签名 " />
								</form>
							</div>
						</div>
						<div style="width: 50%;margin-top: 20px;">
							<form enctype="multipart/form-data" style="margin-top: 10px;" id="form">
								<input id="headImage" name="headImage" type="file" accept=".png,.jpg,.jpeg,.gif" />
							</form>
						</div>
					</div>
					</dir>

				</div>
				<div class="tabs">
					<input type="radio" id="tab1" name="tab-control" checked="checked">
					<input type="radio" id="tab2" name="tab-control">
					<input type="radio" id="tab3" name="tab-control">
					<input type="radio" id="tab4" name="tab-control">
					<ul>
						<li title="投稿">
							<label for="tab1" role="button">
							<span class="n-submission-icon n-icon"></span>
							<span>投稿</span>
							</label>
						</li>
						<li title="收藏夹">
							<label for="tab2" role="button">
								<span class="n-collect-icon n-icon"></span>
								<span>收藏夹</span>
							</label>
						</li>
						<li title="关注用户">
							<label for="tab3" role="button">
								<span class="n-follow-icon n-icon"></span>
							    <span>关注用户</span>
							</label>
						</li>
						<li title="消息列表">
							<label for="tab4" role="button">
							<span class="n-message-icon n-icon"></span>
							<span>消息列表</span>
							</label>
						</li>
					</ul>

					<div class="slider">
						<div class="indicator"></div>
					</div>
					<div class="content">
						<section>
							<div id="submissionList" class="contenDiv">
								<ul class="videoHengList">
									<li>
										<a href="javascript:void(0);" title="">
											<div>
												<img src="../img/common/cover.jpg" class="videoCoverSize" />
											</div>
											<div class="videoTitle">
												&nbsp;
											</div>
										</a>
									</li>
									<li>
										<a href="javascript:void(0);" title="">
											<div>
												<img src="../img/common/cover.jpg" class="videoCoverSize" />
											</div>
											<div class="videoTitle">
												&nbsp;
											</div>
										</a>
									</li>
									<li>
										<a href="javascript:void(0);" title="">
											<div>
												<img src="../img/common/cover.jpg" class="videoCoverSize" />
											</div>
											<div class="videoTitle">
												&nbsp;
											</div>
										</a>
									</li>
									<li>
										<a href="javascript:void(0);" title="">
											<div>
												<img src="../img/common/cover.jpg" class="videoCoverSize" />
											</div>
											<div class="videoTitle">
												&nbsp;
											</div>
										</a>
									</li>
								</ul>
								<ul class="videoHengList">
									<li>
										<a href="javascript:void(0);" title="">
											<div>
												<img src="../img/common/cover.jpg" class="videoCoverSize" />
											</div>
											<div class="videoTitle">
												&nbsp;
											</div>
										</a>
									</li>
									<li>
										<a href="javascript:void(0);" title="">
											<div>
												<img src="../img/common/cover.jpg" class="videoCoverSize" />
											</div>
											<div class="videoTitle">
												&nbsp;
											</div>
										</a>
									</li>
									<li>
										<a href="javascript:void(0);" title="">
											<div>
												<img src="../img/common/cover.jpg" class="videoCoverSize" />
											</div>
											<div class="videoTitle">
												&nbsp;
											</div>
										</a>
									</li>
									<li>
										<a href="javascript:void(0);" title="">
											<div>
												<img src="../img/common/cover.jpg" class="videoCoverSize" />
											</div>
											<div class="videoTitle">
												&nbsp;
											</div>
										</a>
									</li>
								</ul>

							</div>
							<div class="M-box" style="float: right;"></div>
						</section>
						<section>
							<div id="submissionList" class="contenDiv">
								<ul class="videoHengList">
									<li>
										<a href="javascript:void(0);" title="">
											<div>
												<img src="../img/common/cover.jpg" class="videoCoverSize" />
											</div>
											<div class="videoTitle">
												&nbsp;
											</div>
										</a>
									</li>
									<li>
										<a href="javascript:void(0);" title="">
											<div>
												<img src="../img/common/cover.jpg" class="videoCoverSize" />
											</div>
											<div class="videoTitle">
												&nbsp;
											</div>
										</a>
									</li>
									<li>
										<a href="javascript:void(0);" title="">
											<div>
												<img src="../img/common/cover.jpg" class="videoCoverSize" />
											</div>
											<div class="videoTitle">
												&nbsp;
											</div>
										</a>
									</li>
									<li>
										<a href="javascript:void(0);" title="">
											<div>
												<img src="../img/common/cover.jpg" class="videoCoverSize" />
											</div>
											<div class="videoTitle">
												&nbsp;
											</div>
										</a>
									</li>
								</ul>
								<ul class="videoHengList">
									<li>
										<a href="javascript:void(0);" title="">
											<div>
												<img src="../img/common/cover.jpg" class="videoCoverSize" />
											</div>
											<div class="videoTitle">
												&nbsp;
											</div>
										</a>
									</li>
									<li>
										<a href="javascript:void(0);" title="">
											<div>
												<img src="../img/common/cover.jpg" class="videoCoverSize" />
											</div>
											<div class="videoTitle">
												&nbsp;
											</div>
										</a>
									</li>
									<li>
										<a href="javascript:void(0);" title="">
											<div>
												<img src="../img/common/cover.jpg" class="videoCoverSize" />
											</div>
											<div class="videoTitle">
												&nbsp;
											</div>
										</a>
									</li>
									<li>
										<a href="javascript:void(0);" title="">
											<div>
												<img src="../img/common/cover.jpg" class="videoCoverSize" />
											</div>
											<div class="videoTitle">
												&nbsp;
											</div>
										</a>
									</li>
								</ul>

							</div>
							<div class="M-box" style="float: right;"></div>
						</section>

						<section>
							Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut aliquip ex ea commodo consequat. Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat, vel illum dolore eu feugiat nulla facilisis at vero eros et accumsan et iusto odio dignissim qui blandit praesent luptatum zzril delenit augue duis dolore te feugait nulla facilisi. Nam liber tempor cum soluta nobis eleifend option congue nihil imperdiet doming id quod mazim placerat facer possim assum.
						</section>
						<section>
							Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut aliquip ex ea commodo consequat. Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat, vel illum dolore eu feugiat nulla facilisis at vero eros et accumsan et iusto odio dignissim qui blandit praesent luptatum zzril delenit augue duis dolore te feugait nulla facilisi. Nam liber tempor cum soluta nobis eleifend option congue nihil imperdiet doming id quod mazim placerat facer possim assum.
						</section>
					</div>
				</div>
			</div>

			<div class="modal fade" id="tip" aria-hidden="true" data-show="false">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h4 class="modal-title">提示</h4>
						</div>
						<div class="modal-body">
							修改成功
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-primary" data-dismiss="modal">关闭</button>
						</div>
					</div>
					<!-- /.modal-content -->
				</div>
				<!-- /.modal-dialog -->
			</div>
			<!-- /.modal -->
			<script type="text/javascript ">
				var tab1 = {
					no: 1,
					currentPage: 1
				};

				var tab2 = {
					no: 2,
					currentPage: 1
				};

				var tab3 = {
					no: 3,
					currentPage: 1
				};

				var tab4 = {
					no: 4,
					currentPage: 1
				};

				var currentTab = tab1;

				$("label").click(function() {
					console.info($(this).attr("for"));
				});

				$('.M-box').pagination({
					jump: true,
					totalData: 20,
					showData: 8,
					callback: function(c) {

					}
				});

				$(function() {
					$("#headImage").prev().text("更改头像");
					$("#tab2").attr("checked", "checked");
				});

				$('#headImage').fileinput({
					showPreview: false,
					language: 'zh',
					uploadUrl: data_path + "/user/updateHead",
					allowedFileExtensions: ['jpg', 'png', 'gif', 'jpeg'],
				});

				$("#headImage").on("fileuploaded", function(event, data, previewId, index) {
					data = data.response;
					if(data.status === successStatus) {
						user = data.message.entity;
						$("#tip").modal("show");
					} else {
						$(".redTip").text(data.message.message);
					}
				});

				$("#headImage").change(function() {
					var objUrl = getObjectURL(this.files[0]);
					console.log("objUrl = " + objUrl);
					if(objUrl) {
						$(".bigHeadImage").attr("src", objUrl);
					}
				});
				//建立一個可存取到該file的url
				function getObjectURL(file) {
					var url = null;
					if(window.createObjectURL != undefined) { // basic
						url = window.createObjectURL(file);
					} else if(window.URL != undefined) { // mozilla(firefox)
						url = window.URL.createObjectURL(file);
					} else if(window.webkitURL != undefined) { // webkit or chrome
						url = window.webkitURL.createObjectURL(file);
					}
					return url;
				}

				$("#tip").on("hide.bs.modal", function() {
					window.location.reload();
				});

				function update() {
					$.ajax({
						url: data_path + "/user/update",
						data: $("form").serialize(),
						success: function(data) {
							if(data.status === successStatus) {
								user = data.message.entity;
								$("#tip").modal("show");
							} else {
								$(".redTip").text(data.message.message);
							}
						},
						dataType: "json",
						xhrFields: {
							withCredentials: true
						},
						crossDomain: true
					});

				}

				function showSex() {
					$("select").css("display", "inline-block");
				}

				$(document).bind('click', function(e) {
					var e = e || window.event; //浏览器兼容性 
					var elem = e.target || e.srcElement;
					while(elem) { //循环判断至跟节点，防止点击的是div子元素 
						if(elem.id && (elem.id == 'selectSex' || elem.id == 'showSex')) {
							return;
						}
						elem = elem.parentNode;
					}

					$('#selectSex').css('display', 'none'); //点击的不是div或其子元素 
				});

				$(function() {
					window.document.title = user.username;
					$("h2").text(user.username);
					setUserMessage();
				});

				function setUserMessage() {
					$(".bigHeadImage ").attr("src", user.relativePath);
					$("#selectSex").val(user.sex);
					$("input[name='signature']").val(user.signature);
					if(user.sex === male) {
						$(".secret").removeClass("secret").removeClass("female").addClass("male");
					} else if(user.sex === female) {
						$(".secret").removeClass("secret").removeClass("male").addClass("female");
					} else {
						$(".secret").removeClass("female").removeClass("male").addClass("secret");
					}
				}
			</script>
	</body>

</html>